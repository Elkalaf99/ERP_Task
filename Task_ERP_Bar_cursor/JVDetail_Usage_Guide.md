# 🎯 دليل استخدام إضافة JVDetail

## 📋 المشكلة والحل

### المشكلة الأصلية:

- في `JVAddFormComponent` لا يوجد حقل لإدخال `jVID`
- `jVID` مطلوب في `JVDetailDto` لكن المستخدم لا يعرف قيمته

### الحل المطبق:

- إنشاء صفحة منفصلة `JVDetailAddComponent` لإضافة تفاصيل لـ JV موجود
- إضافة حقل لإدخال `jVID` في الصفحة الجديدة

## 🚀 كيفية الاستخدام

### الخطوة 1: الوصول للصفحة

1. افتح المتصفح: `https://localhost:7240`
2. اذهب إلى: **Journal Vouchers** → **Add JV Detail**
3. أو مباشرة: `https://localhost:7240/JVDetailAddComponent`

### الخطوة 2: إدخال JV ID

1. في حقل **"JV ID"** أدخل معرف القيد الموجود
2. مثال: `1` أو `2` أو `3`
3. اضغط **"Load JV Details"**

### الخطوة 3: مراجعة معلومات JV

- ستظهر معلومات القيد:
  - رقم القيد: `JV-2024-001`
  - التاريخ: `15/01/2024`
  - الإجماليات: `$10,000.00 / $10,000.00`

### الخطوة 4: إضافة التفاصيل

1. **اختر الحساب** من القائمة المنسدلة
2. **اختر الحساب الفرعي** (اختياري)
3. **أدخل المبلغ**:
   - **مدين**: أدخل القيمة في عمود Debit
   - **دائن**: أدخل القيمة في عمود Credit
4. **حدد "موثق"** إذا كان مطلوباً
5. **أضف ملاحظات** (اختياري)

### الخطوة 5: إضافة صفوف إضافية

- اضغط **"Add Row"** لإضافة صف جديد
- كرر الخطوات السابقة لكل صف

### الخطوة 6: الحفظ

- اضغط **"Save Detail"** لحفظ التفاصيل
- أو **"Save And Close"** للحفظ والعودة للصفحة الرئيسية

## 📊 مثال عملي

### البيانات المدخلة:

| #   | Account   | SubAccount | Debit | Credit | Documented | Notes      |
| --- | --------- | ---------- | ----- | ------ | ---------- | ---------- |
| 1   | النقدية   | -          | 5000  | 0      | ✅         | إيداع نقدي |
| 2   | الإيرادات | -          | 0     | 3000   | ✅         | إيراد نقدي |
| 3   | الخصوم    | -          | 0     | 2000   | ✅         | خصم نقدي   |

### النتيجة:

- **إجمالي المدين**: $5,000.00
- **إجمالي الدائن**: $5,000.00
- **الفرق**: $0.00 ✅

## ⚠️ قواعد مهمة

### 1. التحقق من التوازن:

- إجمالي المدين = إجمالي الدائن
- الفرق يجب أن يكون 0

### 2. قواعد الإدخال:

- لا يمكن إدخال مدين ودائن في نفس الصف
- يجب إدخال إما مدين أو دائن في كل صف
- يجب اختيار حساب لكل صف

### 3. التحقق من البيانات:

- JV ID يجب أن يكون موجوداً
- الحسابات يجب أن تكون موجودة في قاعدة البيانات

## 🔧 الميزات المتاحة

### 1. تحميل التفاصيل الموجودة:

- عند إدخال JV ID صحيح، يتم تحميل التفاصيل الموجودة
- يمكن إضافة تفاصيل جديدة للتفاصيل الموجودة

### 2. التحقق التلقائي:

- التحقق من صحة JV ID
- التحقق من التوازن
- التحقق من صحة البيانات المدخلة

### 3. واجهة تفاعلية:

- إضافة وحذف صفوف
- حساب الإجماليات تلقائياً
- مؤشرات بصرية للتوازن

## 🚨 رسائل الخطأ الشائعة

### 1. "Please enter a valid JV ID"

- **السبب**: JV ID فارغ أو غير صحيح
- **الحل**: أدخل JV ID صحيح

### 2. "JV with ID X not found"

- **السبب**: JV ID غير موجود في قاعدة البيانات
- **الحل**: تحقق من JV ID أو أنشئ JV جديد أولاً

### 3. "Please select an account for all detail rows"

- **السبب**: لم يتم اختيار حساب في أحد الصفوف
- **الحل**: اختر حساب لكل صف

### 4. "A detail row cannot have both debit and credit amounts"

- **السبب**: تم إدخال مدين ودائن في نفس الصف
- **الحل**: أدخل إما مدين أو دائن فقط

## 📝 ملاحظات تقنية

### 1. API Calls:

```
GET /api/jv/{id} - تحميل JV
GET /api/JVDetail/jv/{jvId} - تحميل تفاصيل JV
POST /api/JVDetail - إضافة تفصيل جديد
```

### 2. البيانات المرسلة:

```json
{
  "jVID": 1,
  "accountID": 4001,
  "subAccountID": null,
  "debit": null,
  "credit": 10000.0,
  "isDocumented": true,
  "notes": "إيراد نقدي",
  "branchID": 1
}
```

### 3. قاعدة البيانات:

- يتم حفظ التفاصيل في جدول `JVDetails`
- كل تفصيل مرتبط بـ JV عبر `JVID`
- يتم التحقق من العلاقات الخارجية

## ✅ النتيجة النهائية

بعد الاستخدام الصحيح:

- **JV موجود** في قاعدة البيانات
- **تفاصيل جديدة** مضافة لـ JV
- **نظام متوازن** (مدين = دائن)
- **بيانات صحيحة** ومتحققة

هذا الحل يحل مشكلة `jVID` ويوفر واجهة سهلة لإضافة تفاصيل لـ JV موجود! 🎯
